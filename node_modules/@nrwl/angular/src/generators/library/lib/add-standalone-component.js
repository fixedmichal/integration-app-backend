"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.addStandaloneComponent = void 0;
const tslib_1 = require("tslib");
const component_1 = require("../../component/component");
const path_1 = require("nx/src/utils/path");
const devkit_1 = require("@nrwl/devkit");
const add_load_children_1 = require("./add-load-children");
const add_children_1 = require("./add-children");
function addStandaloneComponent(tree, { libraryOptions, componentOptions }) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        yield (0, component_1.default)(tree, Object.assign(Object.assign({}, componentOptions), { name: componentOptions.name, standalone: true, export: true, project: libraryOptions.name, flat: componentOptions.flat }));
        if (libraryOptions.routing) {
            const pathToRoutes = (0, path_1.joinPathFragments)(libraryOptions.projectRoot, 'src/lib/lib.routes.ts');
            const routesContents = `import { Route } from '@angular/router';
    import { ${libraryOptions.standaloneComponentName} } from './${(0, path_1.joinPathFragments)(componentOptions.flat ? '' : libraryOptions.fileName, `${libraryOptions.fileName}.component`)}';
    
        export const ${(0, devkit_1.names)(libraryOptions.name).propertyName}Routes: Route[] = [
          {path: '', component: ${libraryOptions.standaloneComponentName}}
        ];`;
            tree.write(pathToRoutes, routesContents);
            const pathToEntryFile = (0, path_1.joinPathFragments)(libraryOptions.projectRoot, 'src', `${libraryOptions.entryFile}.ts`);
            const entryFileContents = tree.read(pathToEntryFile, 'utf-8');
            tree.write(pathToEntryFile, `${entryFileContents}
        export * from './lib/lib.routes'`);
            if (libraryOptions.parent) {
                if (libraryOptions.lazy) {
                    (0, add_load_children_1.addLoadChildren)(tree, libraryOptions);
                }
                else {
                    (0, add_children_1.addChildren)(tree, libraryOptions);
                }
            }
        }
    });
}
exports.addStandaloneComponent = addStandaloneComponent;
//# sourceMappingURL=add-standalone-component.js.map